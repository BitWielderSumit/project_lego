# Kafka Local Development Configuration
# Single configuration file using Bitnami Secure Images with KRaft mode
# Optimized for Docker Desktop on macOS

# === IMAGE CONFIGURATION ===
# Using Bitnami Legacy Images (stable, proven version)
# Note: This is Kafka 3.9.0 - stable and suitable for local development
image:
  registry: docker.io
  repository: bitnamilegacy/kafka
  tag: 3.9.0-debian-12-r4

# === KRAFT MODE (Modern Kafka without ZooKeeper) ===
kraft:
  enabled: true

# === CONTROLLER CONFIGURATION ===
controller:
  replicaCount: 1                        # Single controller for local dev
  controllerOnly: true                   # Dedicated controller (not combined with broker)
  resourcesPreset: "small"               # Use preset for resources
  persistence:
    enabled: true
    size: 8Gi
    storageClass: ""
  # Explicit KRaft configuration for controller quorum
  extraEnvVars:
    - name: KAFKA_CFG_CONTROLLER_QUORUM_VOTERS
      value: "0@kafka-local-controller-0.kafka-local-controller-headless.kafka.svc.cluster.local:9093"

# === BROKER CONFIGURATION ===
broker:
  replicaCount: 1                        # Single dedicated broker
  resourcesPreset: "small"               # Use preset for resources
  persistence:
    enabled: true
    size: 8Gi
    storageClass: ""

# === VOLUME PERMISSIONS ===
volumePermissions:
  enabled: true                          # Fix permission issues on Docker Desktop

# === AUTHENTICATION ===
auth:
  clientProtocol: plaintext              # Simple auth for local dev
  interBrokerProtocol: plaintext

# === LISTENERS ===
listeners:
  client:
    containerPort: 9092
    protocol: PLAINTEXT
    name: CLIENT
  controller:
    name: CONTROLLER
    containerPort: 9093
    protocol: PLAINTEXT
  interbroker:
    containerPort: 9094
    protocol: PLAINTEXT
    name: INTERNAL

# === EXTERNAL ACCESS ===
externalAccess:
  enabled: false                         # No external access needed locally

# === METRICS ===
# Disabled for local dev - JMX exporter image also deprecated by Bitnami
metrics:
  kafka:
    enabled: false
  jmx:
    enabled: false

# === SERVICE CONFIGURATION ===
service:
  type: ClusterIP                        # Internal service only
  ports:
    client: 9092

# === LOGGING ===
logLevel: INFO
logsDirs: "/opt/bitnami/kafka/logs"

# === JVM SETTINGS ===
heapOpts: "-Xmx512m -Xms512m"            # Reasonable heap for local dev

# === CONSUMER OFFSETS ===
offsets:
  topic:
    replicationFactor: 1                 # Single replica for consumer offsets
    numPartitions: 50                    # Standard partitions for offsets topic

